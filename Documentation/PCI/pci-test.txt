				PCI TEST
		    Kishon Vijay Abraham I <kishon@ti.com>

Traditionally PCI RC has always been validated by using standard
PCI cards like ethernet PCI cards or USB PCI cards or SATA PCI cards.
However with the addition of EP-core in linux kernel, it is possible
to configure a PCI controller that can operate in EP mode to work as
a test device.

The PCI endpoint test device is a completely software device used to
test the endpoint functionality and serve as a sample driver for other
PCI endpoint devices.

The PCI endpoint test device has four registers:

	1) PCI_ENDPOINT_TEST_COMMAND
	2) PCI_ENDPOINT_TEST_STATUS
	3) PCI_ENDPOINT_TEST_SRC_ADDR
	4) PCI_ENDPOINT_TEST_DST_ADDR

Since this is a virtual device, all these registers will be present
in RAM and will be allocated using one of the standard memory allocation
API (in this case dma_alloc_coherent)

*) PCI_ENDPOINT_TEST_COMMAND:

This register will be used by the host driver to indicate the function
that the endpoint device must perform.

Bitfield Description:
  Bit 0: reset the PCI endpoint device
  Bit 1: raise irq
  Bit 2: Copy the data from source addr to destination address

*) PCI_ENDPOINT_TEST_STATUS

This register reflects the status of the PCI endpoint device.

Bitfield Description:
  Bit 0: PCI endpoint device is in initialized state
  Bit 1: Copy is in progress
  Bit 2: Copy is done
  Bit 3: IRQ is raised
  Bit 4: Source address is invalid
  Bit 5: Destination address is invalid

*) PCI_ENDPOINT_TEST_SRC_ADDR

This register contains the source address for the COPY command.

*) PCI_ENDPOINT_TEST_DST_ADDR

This register contains the destination address for the COPY command.

PCI ENDPOINT TEST DRIVER (EP SIDE)
==================================

The Endpoint side function driver is present in
drivers/pci/endpoint/functions/pci-epf-test.c

This function driver creates the PCI endpoint test device and then
waits for commands from the host driver. If the host driver sets
Bit 1 (raise irq) in the COMMAND register, the endpoint driver
will raise an irq. Similarly it resets the device if Bit 0 is set
and starts copying the data if Bit 2 is set.

The function driver is also responsible for updating the STATUS
register.

PCI ENDPOINT TEST DRIVER (HOST SIDE)
====================================

The host side PCI driver is present in
drivers/misc/pci_endpoint_test.c

The PCI driver for the test device performs 3 tests
	*) Verifying addresses programmed in BAR
	*) Raise legacy IRQ
	*) Copy data from source address to destination address (TODO)
